const VERSION='sp-web-r1'; self.addEventListener('install',e=>{e.waitUntil(caches.open(VERSION).then(()=>self.skipWaiting()))}); self.addEventListener('activate',e=>{e.waitUntil(self.clients.claim())}); self.addEventListener('fetch',e=>{const url=new URL(e.request.url); if(url.pathname.startsWith('/api/')){ e.respondWith(fetch(e.request).then(r=>{const s=r.clone(); caches.open(VERSION).then(c=>c.put(e.request,s)); return r}).catch(()=>caches.match(e.request))) } else if(e.request.method==='GET'){ e.respondWith(caches.match(e.request).then(c=>c||fetch(e.request).then(r=>{const s=r.clone(); caches.open(VERSION).then(cs=>cs.put(e.request,s)); return r}))) } });