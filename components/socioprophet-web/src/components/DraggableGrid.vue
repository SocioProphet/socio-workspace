<template><div class='canvas'><div v-for='(c,i) in modelValue' :key='i' class='card-abs' :style='{left:c.x+"px", top:c.y+"px", width:c.w+"px", height:c.h+"px"}'><div class='title' @mousedown='dragStart($event,i)'>{{ c.specId }}</div><div class='content'></div><div class='handle' @mousedown.stop='resizeStart($event,i)'></div></div></div></template><script setup lang='ts'>const props=defineProps<{ modelValue: {specId:string,x:number,y:number,w:number,h:number}[] }>() as any; const emit=defineEmits(['update:modelValue']); let dragging={active:false,idx:-1,dx:0,dy:0}; let resizing={active:false,idx:-1,sx:0,sy:0}; function dragStart(e:MouseEvent,idx:number){ dragging={active:true,idx,dx:e.clientX-props.modelValue[idx].x,dy:e.clientY-props.modelValue[idx].y}; window.addEventListener('mousemove',dragMove); window.addEventListener('mouseup',dragEnd) } function dragMove(e:MouseEvent){ if(!dragging.active) return; const arr=props.modelValue.slice(); const c={...arr[dragging.idx]}; c.x=Math.max(0,e.clientX-dragging.dx); c.y=Math.max(0,e.clientY-dragging.dy); arr[dragging.idx]=c; emit('update:modelValue',arr) } function dragEnd(){ dragging={active:false,idx:-1,dx:0,dy:0}; window.removeEventListener('mousemove',dragMove); window.removeEventListener('mouseup',dragEnd) } function resizeStart(e:MouseEvent,idx:number){ resizing={active:true,idx,sx:e.clientX,sy:e.clientY}; window.addEventListener('mousemove',resizeMove); window.addEventListener('mouseup',resizeEnd) } function resizeMove(e:MouseEvent){ if(!resizing.active) return; const arr=props.modelValue.slice(); const c={...arr[resizing.idx]}; c.w=Math.max(260,c.w+(e.clientX-resizing.sx)); c.h=Math.max(200,c.h+(e.clientY-resizing.sy)); resizing.sx=e.clientX; resizing.sy=e.clientY; arr[resizing.idx]=c; emit('update:modelValue',arr) } function resizeEnd(){ resizing={active:false,idx:-1,sx:0,sy:0}; window.removeEventListener('mousemove',resizeMove); window.removeEventListener('mouseup',resizeEnd) }</script>